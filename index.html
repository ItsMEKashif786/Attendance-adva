<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madrasatulmadina Balighan Attendance</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --text-lighter: #999999;
            --border: #e0e0e0;
            --hazir: #388e3c;
            --gayib: #d32f2f;
            --card-shadow: 0 4px 12px rgba(46, 125, 50, 0.1);
            --hover-shadow: 0 6px 16px rgba(46, 125, 50, 0.15);
            --radius: 8px;
            --spacing: 24px;
            --spacing-sm: 16px;
            --spacing-xs: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing);
        }

        header {
            text-align: center;
            margin-bottom: var(--spacing);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--border);
        }

        h1 {
            font-size: 32px;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: var(--spacing-xs);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: var(--spacing-sm);
        }

        .logo i {
            font-size: 28px;
        }

        .tabs {
            display: flex;
            margin-bottom: var(--spacing);
            background-color: var(--secondary);
            border-radius: var(--radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }

        .tab {
            padding: var(--spacing-sm) var(--spacing);
            cursor: pointer;
            background-color: var(--secondary);
            border: none;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.3s ease;
            position: relative;
            flex: 1;
            text-align: center;
        }

        .tab.active {
            color: var(--primary);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary);
        }

        .tab:hover:not(.active) {
            color: var(--primary-light);
        }

        .tab-content {
            display: none;
            background-color: var(--secondary);
            border-radius: var(--radius);
            padding: var(--spacing);
            box-shadow: var(--card-shadow);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing);
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            background-color: var(--primary);
            color: var(--secondary);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            box-shadow: var(--hover-shadow);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .btn-secondary:hover {
            background-color: rgba(46, 125, 50, 0.05);
        }

        .btn-hazir {
            background-color: var(--hazir);
        }

        .btn-hazir:hover {
            background-color: #2e7d32;
        }

        .btn-gayib {
            background-color: var(--gayib);
        }

        .btn-gayib:hover {
            background-color: #b71c1c;
        }

        .card {
            background-color: var(--secondary);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
            border-radius: var(--radius);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: var(--hover-shadow);
        }

        .course-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--secondary);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .course-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
        }

        .course-card:hover::before {
            animation: shine 1.5s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) rotate(30deg); }
            100% { transform: translateX(100%) rotate(30deg); }
        }

        .course-card h3 {
            font-size: 18px;
            margin-bottom: 4px;
            font-weight: 600;
            position: relative;
        }

        .course-card p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            position: relative;
        }

        .student-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm);
        }

        .student-info {
            flex: 1;
        }

        .student-info h4 {
            font-size: 16px;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .student-phone {
            font-size: 14px;
            color: var(--text-light);
        }

        .student-actions {
            display: flex;
            gap: var(--spacing-xs);
            align-items: center;
        }

        .attendance-status {
            font-size: 14px;
            margin-right: var(--spacing-xs);
            font-weight: 500;
        }

        .hazir-status {
            color: var(--hazir);
        }

        .gayib-status {
            color: var(--gayib);
        }

        .contact-icons {
            display: flex;
            gap: var(--spacing-xs);
        }

        .contact-icons a {
            color: var(--primary);
            font-size: 18px;
            transition: all 0.3s ease;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(46, 125, 50, 0.1);
        }

        .contact-icons a:hover {
            color: var(--secondary);
            background-color: var(--primary);
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: var(--secondary);
            padding: var(--spacing);
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing);
            padding-bottom: var(--spacing-xs);
            border-bottom: 1px solid var(--border);
        }

        .modal-header h2 {
            font-size: 20px;
            color: var(--primary-dark);
            font-weight: 600;
        }

        .close-btn {
            font-size: 24px;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: var(--spacing-sm);
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text);
            font-size: 14px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-xs);
            margin-top: var(--spacing);
        }

        .sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing);
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .sheet-controls {
            display: flex;
            gap: var(--spacing-xs);
            align-items: center;
            flex-wrap: wrap;
        }

        .sheet-controls input, .sheet-controls select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing);
            box-shadow: var(--card-shadow);
            border-radius: var(--radius);
            overflow: hidden;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background-color: var(--primary);
            color: var(--secondary);
            font-weight: 500;
        }

        tr:hover {
            background-color: rgba(46, 125, 50, 0.03);
        }

        .hazir-cell {
            color: var(--hazir);
            font-weight: 500;
        }

        .gayib-cell {
            color: var(--gayib);
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: var(--spacing);
            color: var(--text-light);
            background-color: var(--secondary);
            border-radius: var(--radius);
            box-shadow: var(--card-shadow);
        }

        .empty-state i {
            font-size: 48px;
            color: var(--primary-light);
            margin-bottom: var(--spacing-xs);
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: var(--spacing-xs);
            color: var(--text);
        }

        .empty-state p {
            font-size: 14px;
        }

        .date-controls {
            display: flex;
            gap: var(--spacing-xs);
            align-items: center;
            background-color: var(--secondary);
            padding: var(--spacing-xs);
            border-radius: var(--radius);
            box-shadow: var(--card-shadow);
            margin-bottom: var(--spacing);
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-sm);
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
                text-align: left;
                padding: var(--spacing-sm);
            }
            
            .tab.active::after {
                height: 100%;
                width: 3px;
                bottom: auto;
                left: auto;
                right: 0;
            }
            
            .student-card {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
            }
            
            .student-actions {
                width: 100%;
                margin-top: var(--spacing-xs);
                justify-content: space-between;
            }
            
            .sheet-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-sm);
            }
            
            .sheet-controls {
                width: 100%;
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 14px;
            }
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--secondary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    <!-- PWA Configuration -->
<meta name="theme-color" content="#4caf50">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-192x192.png">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-mosque"></i>
                <span>Madrasatulmadina Balighan</span>
            </div>
            <h1>Attendance Management System</h1>
        </header>

        <div class="tabs">
            <button class="tab active" data-tab="courses">
                <i class="fas fa-book-open"></i> Courses
            </button>
            <button class="tab" data-tab="students">
                <i class="fas fa-users"></i> Students
            </button>
            <button class="tab" data-tab="sheet">
                <i class="fas fa-calendar-alt"></i> Sheet View
            </button>
        </div>

        <div id="courses" class="tab-content active">
            <div class="section-header">
                <h2 class="section-title">All Courses</h2>
                <button id="addCourseBtn" class="btn">
                    <i class="fas fa-plus"></i> Add Course
                </button>
            </div>
            <div id="coursesList"></div>
        </div>

        <div id="students" class="tab-content">
            <div class="section-header">
                <h2 id="selectedCourseName" class="section-title">Select a Course</h2>
                <div class="date-controls">
                    <input type="date" id="attendanceDate">
                    <button id="todayBtn" class="btn btn-secondary">
                        <i class="fas fa-calendar-day"></i> Today
                    </button>
                    <button id="addStudentBtn" class="btn">
                        <i class="fas fa-user-plus"></i> Add Student
                    </button>
                </div>
            </div>
            <div id="studentsList"></div>
        </div>

        <div id="sheet" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Monthly Attendance Sheet</h2>
                <div class="sheet-controls">
                    <select id="sheetCourseSelect"></select>
                    <input type="month" id="sheetMonth" value="2025-05">
                    <button id="downloadSheetBtn" class="btn">
                        <i class="fas fa-file-excel"></i> Export CSV
                    </button>
                </div>
            </div>
            <div id="sheetTableContainer"></div>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div id="addCourseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-book-open"></i> Add New Course</h2>
                <button class="close-btn">&times;</button>
            </div>
            <form id="addCourseForm">
                <div class="form-group">
                    <label for="courseName">Course Name</label>
                    <input type="text" id="courseName" required placeholder="e.g. Quran Memorization">
                </div>
                <div class="form-group">
                    <label for="teacherName">Teacher Name</label>
                    <input type="text" id="teacherName" required placeholder="e.g. Ustadh Ahmed">
                </div>
                <div class="form-group">
                    <label for="courseTime">Time Slot</label>
                    <input type="text" id="courseTime" placeholder="e.g. 7:00-8:30 PM" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary close-modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Save Course
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Add New Student</h2>
                <button class="close-btn">&times;</button>
            </div>
            <form id="addStudentForm">
                <div class="form-group">
                    <label for="studentName">Student Name</label>
                    <input type="text" id="studentName" required placeholder="e.g. Muhammad Ali">
                </div>
                <div class="form-group">
                    <label for="studentPhone">Phone Number (optional)</label>
                    <input type="tel" id="studentPhone" placeholder="e.g.1234567890">
                    <small style="color: var(--text-light); font-size: 12px;">Enter Whatsapp number suggested</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary close-modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Save Student
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>

        // Add this at the end of your existing script, before the closing 
// Register Service Worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(registration => {
        console.log('ServiceWorker registration successful');
      })
      .catch(err => {
        console.log('ServiceWorker registration failed: ', err);
      });
  });
}
// PWA Installation Prompt
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent the mini-infobar from appearing on mobile
  e.preventDefault();
  // Stash the event so it can be triggered later
  deferredPrompt = e;
  // Show install button (you'll need to add this to your HTML)
  const installButton = document.createElement('button');
  installButton.id = 'install-button';
  installButton.className = 'btn';
  installButton.textContent = 'Install App';
  installButton.style.margin = '10px';
  document.querySelector('h1').insertAdjacentElement('afterend', installButton);
  
  installButton.addEventListener('click', () => {
    // Show the install prompt
    deferredPrompt.prompt();
    // Wait for the user to respond to the prompt
    deferredPrompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the install prompt');
      } else {
        console.log('User dismissed the install prompt');
      }
      deferredPrompt = null;
    });
  });
});

window.addEventListener('appinstalled', () => {
  console.log('PWA was installed');
  const installButton = document.getElementById('install-button');
  if (installButton) {
    installButton.style.display = 'none';
  }
});
        // Data structure
        let data = {
            courses: [],
            students: [],
            attendance: []
        };

        // DOM elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const coursesList = document.getElementById('coursesList');
        const studentsList = document.getElementById('studentsList');
        const selectedCourseName = document.getElementById('selectedCourseName');
        const attendanceDate = document.getElementById('attendanceDate');
        const todayBtn = document.getElementById('todayBtn');
        const sheetCourseSelect = document.getElementById('sheetCourseSelect');
        const sheetMonth = document.getElementById('sheetMonth');
        const sheetTableContainer = document.getElementById('sheetTableContainer');
        const downloadSheetBtn = document.getElementById('downloadSheetBtn');

        // Modal elements
        const addCourseModal = document.getElementById('addCourseModal');
        const addStudentModal = document.getElementById('addStudentModal');
        const addCourseBtn = document.getElementById('addCourseBtn');
        const addStudentBtn = document.getElementById('addStudentBtn');
        const closeButtons = document.querySelectorAll('.close-btn, .close-modal');
        const addCourseForm = document.getElementById('addCourseForm');
        const addStudentForm = document.getElementById('addStudentForm');

        // Current state
        let currentCourseId = null;
        let currentDate = new Date().toISOString().split('T')[0];

        // Initialize the app
        function init() {
            loadData();
            setupEventListeners();
            renderCourses();
            setCurrentDate();
        }

        // Load data from localStorage or initialize with sample data
        function loadData() {
            const savedData = localStorage.getItem('attendanceData');
            if (savedData) {
                data = JSON.parse(savedData);
            } else {
                // Initialize with sample data
                data = {
                    courses: [
                        { id: '1', name: 'Madani Qaidah Memorization', teacher: 'Ustadh Ubaid Attari', time: '7:00-8:00 PM' }
                    
                    ],
                    students: [
                        { id: '1', courseId: '1', name: 'Tauheed Ansari', phone: '+918881295964' }
                        
                    ],
                    attendance: [
                        { studentId: '1', date: '2025-05-17', status: 'Hazir' },
                        { studentId: '2', date: '2025-05-17', status: 'Gayib' },
                        { studentId: '3', date: '2025-05-17', status: 'Hazir' }
                    ]
                };
                saveData();
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('attendanceData', JSON.stringify(data));
        }

        // Set up event listeners
        function setupEventListeners() {
            // Tab navigation
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                    
                    if (tab.dataset.tab === 'students' && currentCourseId) {
                        renderStudents();
                    } else if (tab.dataset.tab === 'sheet') {
                        renderSheetView();
                    }
                });
            });

            // Date picker
            attendanceDate.addEventListener('change', (e) => {
                currentDate = e.target.value;
                renderStudents();
            });

            // Today button
            todayBtn.addEventListener('click', () => {
                setCurrentDate();
                renderStudents();
            });

            // Add course button
            addCourseBtn.addEventListener('click', () => {
                addCourseModal.style.display = 'flex';
                document.getElementById('courseName').focus();
            });

            // Add student button
            addStudentBtn.addEventListener('click', () => {
                if (!currentCourseId) {
                    showAlert('Please select a course first');
                    return;
                }
                addStudentModal.style.display = 'flex';
                document.getElementById('studentName').focus();
            });

            // Close modals
            closeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    addCourseModal.style.display = 'none';
                    addStudentModal.style.display = 'none';
                });
            });

            // Add course form
            addCourseForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const courseName = document.getElementById('courseName').value.trim();
                const teacherName = document.getElementById('teacherName').value.trim();
                const courseTime = document.getElementById('courseTime').value.trim();
                
                const newCourse = {
                    id: Date.now().toString(),
                    name: courseName,
                    teacher: teacherName,
                    time: courseTime
                };
                
                data.courses.push(newCourse);
                saveData();
                renderCourses();
                addCourseModal.style.display = 'none';
                addCourseForm.reset();
                showAlert('Course added successfully!');
            });

            // Add student form
            addStudentForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const studentName = document.getElementById('studentName').value.trim();
                let studentPhone = document.getElementById('studentPhone').value.trim();
                
                // Validate and format phone number
                if (studentPhone) {
                    if (!studentPhone.startsWith('+')) {
                        studentPhone = '+91' + studentPhone;
                    }
                    
                    if (!isValidPhoneNumber(studentPhone)) {
                        showAlert('Please enter a valid phone number with country code (e.g. +911234567890)');
                        return;
                    }
                }
                
                const newStudent = {
                    id: Date.now().toString(),
                    courseId: currentCourseId,
                    name: studentName,
                    phone: studentPhone || null
                };
                
                data.students.push(newStudent);
                saveData();
                renderStudents();
                addStudentModal.style.display = 'none';
                addStudentForm.reset();
                showAlert('Student added successfully!');
            });

            // Download sheet button
            downloadSheetBtn.addEventListener('click', () => {
                downloadCSV();
            });
        }

        // Set current date in date picker
        function setCurrentDate() {
            currentDate = new Date().toISOString().split('T')[0];
            attendanceDate.value = currentDate;
        }

        // Validate phone number
        function isValidPhoneNumber(phone) {
            const regex = /^\+\d{10,15}$/;
            return regex.test(phone);
        }

        // Show alert message
        function showAlert(message) {
            const alert = document.createElement('div');
            alert.className = 'alert-message';
            alert.textContent = message;
            alert.style.position = 'fixed';
            alert.style.bottom = '20px';
            alert.style.left = '50%';
            alert.style.transform = 'translateX(-50%)';
            alert.style.backgroundColor = 'var(--primary)';
            alert.style.color = 'white';
            alert.style.padding = '12px 24px';
            alert.style.borderRadius = 'var(--radius)';
            alert.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            alert.style.zIndex = '1001';
            alert.style.animation = 'fadeIn 0.3s ease';
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(alert);
                }, 300);
            }, 3000);
        }

        // Render courses list
        function renderCourses() {
            coursesList.innerHTML = '';
            
            if (data.courses.length === 0) {
                coursesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <h3>No Courses Found</h3>
                        <p>Add your first course to get started</p>
                    </div>
                `;
                return;
            }
            
            data.courses.forEach(course => {
                const courseCard = document.createElement('div');
                courseCard.className = 'card course-card';
                courseCard.innerHTML = `
                    <h3>${course.name}</h3>
                    <p>${course.teacher} â€¢ ${course.time}</p>
                `;
                courseCard.addEventListener('click', () => {
                    currentCourseId = course.id;
                    selectedCourseName.textContent = course.name;
                    document.querySelector('[data-tab="students"]').click();
                    renderStudents();
                });
                coursesList.appendChild(courseCard);
            });
        }

        // Render students list
        function renderStudents() {
            studentsList.innerHTML = '';
            
            if (!currentCourseId) {
                studentsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>No Course Selected</h3>
                        <p>Please select a course from the Courses tab</p>
                    </div>
                `;
                return;
            }
            
            const course = data.courses.find(c => c.id === currentCourseId);
            if (!course) return;
            
            const courseStudents = data.students.filter(student => student.courseId === currentCourseId);
            
            if (courseStudents.length === 0) {
                studentsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-graduate"></i>
                        <h3>No Students Found</h3>
                        <p>Add students to this course to track attendance</p>
                    </div>
                `;
                return;
            }
            
            courseStudents.forEach(student => {
                const studentCard = document.createElement('div');
                studentCard.className = 'card student-card';
                
                // Check if attendance is already marked for this date
                const attendanceRecord = data.attendance.find(
                    record => record.studentId === student.id && record.date === currentDate
                );
                
                let statusHtml = '';
                let contactHtml = '';
                
                if (attendanceRecord) {
                    statusHtml = `
                        <span class="attendance-status ${attendanceRecord.status.toLowerCase()}-status">
                            <i class="fas fa-${attendanceRecord.status === 'Hazir' ? 'check' : 'times'}"></i> ${attendanceRecord.status} on ${formatDate(currentDate)}
                        </span>
                        <button class="btn btn-secondary edit-attendance" data-student-id="${student.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    `;
                } else {
                    statusHtml = `
                        <button class="btn btn-hazir mark-attendance" data-student-id="${student.id}" data-status="Hazir">
                            <i class="fas fa-check"></i> Hazir
                        </button>
                        <button class="btn btn-gayib mark-attendance" data-student-id="${student.id}" data-status="Gayib">
                            <i class="fas fa-times"></i> Gayib
                        </button>
                    `;
                }
                
                if (student.phone) {
                    const message = encodeURIComponent(`${student.name} is ${attendanceRecord ? attendanceRecord.status : 'Hazir'} on ${formatDate(currentDate)} - ${course.name} - Madrasatulmadina Balighan Attendance `);
                    contactHtml = `
                        <div class="contact-icons">
                            <a href="tel:${student.phone}" title="Call ${student.name}">
                                <i class="fas fa-phone"></i>
                            </a>
                            <a href="https://wa.me/${student.phone}?text=${message}" target="_blank" title="Message ${student.name} on WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        </div>
                    `;
                }
                
                studentCard.innerHTML = `
                    <div class="student-info">
                        <h4>${student.name}</h4>
                        ${student.phone ? `<div class="student-phone">${student.phone}</div>` : ''}
                    </div>
                    <div class="student-actions">
                        ${statusHtml}
                        ${contactHtml}
                    </div>
                `;
                
                studentsList.appendChild(studentCard);
            });
            
            // Add event listeners for attendance buttons
            document.querySelectorAll('.mark-attendance').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const studentId = e.currentTarget.dataset.studentId;
                    const status = e.currentTarget.dataset.status;
                    markAttendance(studentId, status);
                });
            });
            
            document.querySelectorAll('.edit-attendance').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const studentId = e.currentTarget.dataset.studentId;
                    removeAttendance(studentId);
                });
            });
        }

        // Format date for display
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        // Mark attendance for a student
        function markAttendance(studentId, status) {
            // Remove any existing attendance for this student on this date
            data.attendance = data.attendance.filter(
                record => !(record.studentId === studentId && record.date === currentDate)
            );
            
            // Add new attendance record
            data.attendance.push({
                studentId,
                date: currentDate,
                status
            });
            
            saveData();
            renderStudents();
        }

        // Remove attendance for a student
        function removeAttendance(studentId) {
            data.attendance = data.attendance.filter(
                record => !(record.studentId === studentId && record.date === currentDate)
            );
            
            saveData();
            renderStudents();
        }

        // Render sheet view
        function renderSheetView() {
            // Populate course select
            sheetCourseSelect.innerHTML = '';
            data.courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = course.name;
                sheetCourseSelect.appendChild(option);
            });
            
            if (data.courses.length > 0) {
                if (!currentCourseId) {
                    currentCourseId = data.courses[0].id;
                }
                sheetCourseSelect.value = currentCourseId;
            }
            
            // Render table
            updateSheetTable();
            
            // Add event listeners
            sheetCourseSelect.addEventListener('change', (e) => {
                currentCourseId = e.target.value;
                updateSheetTable();
            });
            
            sheetMonth.addEventListener('change', updateSheetTable);
        }

        // Update sheet table based on selected course and month
        function updateSheetTable() {
            if (!currentCourseId) {
                sheetTableContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book"></i>
                        <h3>No Course Selected</h3>
                        <p>Please select a course to view attendance</p>
                    </div>
                `;
                return;
            }
            
            const selectedMonth = sheetMonth.value;
            const [year, month] = selectedMonth.split('-');
            
            // Get all dates in the selected month
            const daysInMonth = new Date(year, month, 0).getDate();
            const datesInMonth = [];
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${month.padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                datesInMonth.push(dateStr);
            }
            
            // Get students in the selected course
            const courseStudents = data.students.filter(student => student.courseId === currentCourseId);
            
            if (courseStudents.length === 0) {
                sheetTableContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-graduate"></i>
                        <h3>No Students Found</h3>
                        <p>This course doesn't have any students yet</p>
                    </div>
                `;
                return;
            }
            
            // Get course name
            const course = data.courses.find(c => c.id === currentCourseId);
            const courseName = course ? course.name : 'Course';
            
            // Create table
            const table = document.createElement('table');
            
            // Create header row
            const headerRow = document.createElement('tr');
            const studentHeader = document.createElement('th');
            studentHeader.textContent = 'Student';
            headerRow.appendChild(studentHeader);
            
            datesInMonth.forEach(date => {
                const dateHeader = document.createElement('th');
                const dateObj = new Date(date);
                dateHeader.textContent = dateObj.getDate();
                dateHeader.title = dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
                headerRow.appendChild(dateHeader);
            });
            
            // Add percentage column
            const percentageHeader = document.createElement('th');
            percentageHeader.textContent = 'Attendance %';
            headerRow.appendChild(percentageHeader);
            
            table.appendChild(headerRow);
            
            // Create rows for each student
            courseStudents.forEach(student => {
                const row = document.createElement('tr');
                
                // Student name cell
                const nameCell = document.createElement('td');
                nameCell.textContent = student.name;
                row.appendChild(nameCell);
                
                let presentDays = 0;
                
                // Attendance cells for each date
                datesInMonth.forEach(date => {
                    const attendanceRecord = data.attendance.find(
                        record => record.studentId === student.id && record.date === date
                    );
                    
                    const attendanceCell = document.createElement('td');
                    attendanceCell.className = attendanceRecord ? `${attendanceRecord.status.toLowerCase()}-cell` : '';
                    attendanceCell.textContent = attendanceRecord ? attendanceRecord.status.charAt(0) : '';
                    attendanceCell.title = attendanceRecord ? 
                        `${attendanceRecord.status} on ${formatDate(date)}` : 
                        `No record for ${formatDate(date)}`;
                    
                    if (attendanceRecord && attendanceRecord.status === 'Hazir') {
                        presentDays++;
                    }
                    
                    row.appendChild(attendanceCell);
                });
                
                // Calculate attendance percentage
                const percentageCell = document.createElement('td');
                const attendancePercentage = Math.round((presentDays / datesInMonth.length) * 100);
                percentageCell.textContent = `${attendancePercentage}%`;
                percentageCell.style.fontWeight = '500';
                percentageCell.style.color = attendancePercentage >= 75 ? 'var(--hazir)' : 
                                            attendancePercentage >= 50 ? 'var(--primary)' : 'var(--gayib)';
                row.appendChild(percentageCell);
                
                table.appendChild(row);
            });
            
            sheetTableContainer.innerHTML = '';
            sheetTableContainer.appendChild(table);
        }

        // Download CSV of attendance data
        function downloadCSV() {
            if (!currentCourseId) {
                showAlert('Please select a course first');
                return;
            }
            
            const selectedMonth = sheetMonth.value;
            const [year, month] = selectedMonth.split('-');
            
            // Get all dates in the selected month
            const daysInMonth = new Date(year, month, 0).getDate();
            const datesInMonth = [];
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${month.padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                datesInMonth.push(dateStr);
            }
            
            // Get students in the selected course
            const courseStudents = data.students.filter(student => student.courseId === currentCourseId);
            
            if (courseStudents.length === 0) {
                showAlert('No students in this course');
                return;
            }
            
            // Get course name
            const course = data.courses.find(c => c.id === currentCourseId);
            const courseName = course ? course.name : 'Course';
            
            // Create CSV content
            let csvContent = 'Student Name,';
            csvContent += datesInMonth.join(',') + ',Attendance %\n';
            
            courseStudents.forEach(student => {
                csvContent += `"${student.name.replace(/"/g, '""')}",`;
                
                let presentDays = 0;
                const attendanceCells = datesInMonth.map(date => {
                    const attendanceRecord = data.attendance.find(
                        record => record.studentId === student.id && record.date === date
                    );
                    
                    if (attendanceRecord && attendanceRecord.status === 'Hazir') {
                        presentDays++;
                    }
                    
                    return attendanceRecord ? attendanceRecord.status : '';
                });
                
                const attendancePercentage = Math.round((presentDays / datesInMonth.length) * 100);
                
                csvContent += attendanceCells.join(',') + `,${attendancePercentage}%\n`;
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `${courseName} Attendance ${selectedMonth}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
